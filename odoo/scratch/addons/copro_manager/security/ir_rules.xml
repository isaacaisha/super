<!-- /home/siisi/super/odoo/scratch/addons/copro_manager/security/ir_rules.xml -->

<odoo>
  <data noupdate="1">
    <!-- Restrict Supersyndic to their own record -->
    <record id="copro_supersyndic_rule" model="ir.rule">
        <field name="name">Super Syndic Data Rule</field>
        <field name="model_id" ref="model_copro_supersyndic"/>
        <field name="domain_force">[('user_id', '=', user.id)]</field>
        <field name="groups" eval="[(6, 0, [ref('copro_manager.group_supersyndic')])]"/>
    </record>

    <!-- Restrict Residences to those linked to the Supersyndic -->
    <!--<record id="copro_residence_supersyndic_rule" model="ir.rule">
        <field name="name">Residence Supersyndic Rule</field>
        <field name="model_id" ref="model_copro_residence"/>
        <field name="domain_force">[('supersyndic_ids.user_id', '=', user.id)]</field>
        <field name="groups" eval="[(6, 0, [ref('copro_manager.group_supersyndic')])]"/>
    </record>-->
    <record id="copro_residence_supersyndic_rule" model="ir.rule">
        <field name="name">Residence Supersyndic Rule</field>
        <field name="model_id" ref="model_copro_residence"/>
        <field name="domain_force">
            [ '|', ('user_id', '=', user.id), ('supersyndic_ids.user_id', '=', user.id) ]
        </field>
        <field name="groups" eval="[(6, 0, [ref('copro_manager.group_supersyndic')])]"/>
    </record>


    <!-- Restrict Syndic to their own record -->
    <record id="copro_syndic_rule" model="ir.rule">
        <field name="name">Syndic Data Rule</field>
        <field name="model_id" ref="model_copro_syndic"/>
        <field name="domain_force">[('user_id', '=', user.id)]</field>
        <field name="groups" eval="[(6, 0, [ref('copro_manager.group_syndic')])]"/>
    </record>

    <!-- Restrict Residences to those linked to the Syndic -->
    <!--<record id="copro_residence_syndic_rule" model="ir.rule">
        <field name="name">Residence Syndic Rule</field>
        <field name="model_id" ref="model_copro_residence"/>
        <field name="domain_force">[('syndic_ids.user_id', '=', user.id)]</field>
        <field name="groups" eval="[(6, 0, [ref('copro_manager.group_syndic')])]"/>
    </record>-->
    <record id="copro_residence_syndic_rule" model="ir.rule">
        <field name="name">Residence Syndic Rule</field>
        <field name="model_id" ref="model_copro_residence"/>
        <field name="domain_force">
            [ '|', ('user_id', '=', user.id), ('syndic_ids.user_id', '=', user.id) ]
        </field>
        <field name="groups" eval="[(6, 0, [ref('copro_manager.group_syndic')])]"/>
    </record>

    <!-- Copropriétaire Rule -->
    <record id="copro_coproprietaire_rule" model="ir.rule">
        <field name="name">Copropriétaire Data Rule</field>
        <field name="model_id" ref="model_copro_coproprietaire"/>
        <field name="domain_force">[('user_id', '=', user.id)]</field>
        <field name="groups" eval="[(6, 0, [ref('copro_manager.group_coproprietaire')])]"/>
        <field name="perm_write" eval="False"/>
        <field name="perm_create" eval="False"/>
        <field name="perm_unlink" eval="False"/>
    </record>

    <!-- Prestataire Rule -->
    <record id="copro_prestataire_rule" model="ir.rule">
        <field name="name">Prestataire Data Rule</field>
        <field name="model_id" ref="model_copro_prestataire"/>
        <field name="domain_force">[('user_id', '=', user.id)]</field>
        <field name="groups" eval="[(6, 0, [ref('copro_manager.group_prestataire')])]"/>
        <field name="perm_write" eval="False"/>
        <field name="perm_create" eval="False"/>
        <field name="perm_unlink" eval="False"/>
    </record>
  </data>
</odoo>
